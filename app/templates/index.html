<!DOCTYPE html>
<html>
<head>
    <title>Comcast Customer Pain Points Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <!-- include Plotly.js from CDN -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Comcast Customer Pain Points Dashboard</h1>

    <div id="topic-chart"></div>

    <div id="sentiment-chart"></div>

    <div id="sentiment-by-topic-chart"></div>

    <div id="topic-trends-chart"></div>

    <!-- insights Section -->
    <h2>Insights and Recommendations</h2>
    {% for topic in topic_labels %}
        <h3>{{ topic }}</h3>
        <p><strong>Number of Complaints:</strong> {{ topic_metrics[topic]['complaint_count'] }}</p>
        <p><strong>Negative Sentiment Percentage:</strong> {{ topic_metrics[topic]['negative_percentage'] }}%</p>
        <p>{{ insights.get(topic, "No insights available yet.") }}</p>
    {% endfor %}

    <!-- sample Posts Section -->
    <h2>Sample Posts by Topic</h2>
    {% for topic, posts in sample_posts.items() %}
        <h3>{{ topic }}</h3>
        <ul>
            {% for post in posts %}
                <li>{{ post }}</li>
            {% endfor %}
        </ul>
    {% endfor %}

    <script type="text/javascript">
        //topic Distribution Chart
        var topicData = [{
            x: {{ topic_labels | safe }},
            y: {{ topic_values | safe }},
            type: 'bar',
            marker: {
                color: '#1f77b4'
            }
        }];

        var topicLayout = {
            title: 'Topic Distribution',
            xaxis: {
                title: 'Topics',
                tickangle: -45,
                automargin: true
            },
            yaxis: {
                title: 'Number of Posts'
            },
            margin: {
                b: 150
            }
        };

        Plotly.newPlot('topic-chart', topicData, topicLayout);

        // sentiment Distribution Chart
        var sentimentData = [{
            x: {{ sentiment_labels | safe }},
            y: {{ sentiment_values | safe }},
            type: 'bar',
            marker: {
                color: '#ff7f0e'
            }
        }];

        var sentimentLayout = {
            title: 'Sentiment Distribution',
            xaxis: {
                title: 'Sentiment'
            },
            yaxis: {
                title: 'Number of Posts'
            }
        };

        Plotly.newPlot('sentiment-chart', sentimentData, sentimentLayout);

        // sentiment by Topic Chart
        var sentimentByTopic = {{ sentiment_by_topic | safe }};
        var topics = Object.keys(sentimentByTopic);
        var sentiments = ['Negative', 'Neutral', 'Positive'];

        var data = [];
        for (var i = 0; i < sentiments.length; i++) {
            var sentiment = sentiments[i];
            var values = [];
            for (var j = 0; j < topics.length; j++) {
                values.push(sentimentByTopic[topics[j]][sentiment] || 0);
            }
            data.push({
                x: topics,
                y: values,
                name: sentiment,
                type: 'bar'
            });
        }

        var layout = {
            barmode: 'stack',
            title: 'Sentiment Distribution by Topic',
            xaxis: {
                title: 'Topics',
                tickangle: -45,
                automargin: true
            },
            yaxis: {
                title: 'Number of Posts'
            },
            margin: {
                b: 150
            }
        };

        Plotly.newPlot('sentiment-by-topic-chart', data, layout);

        // topic Trends Over Time
        var dailyTrends = {{ daily_trends | safe }};
        var dates = dailyTrends['created_date'];
        var data = [];
        var topics = Object.keys(dailyTrends).filter(key => key !== 'created_date');
        for (var i = 0; i < topics.length; i++) {
            var topic = topics[i];
            data.push({
                x: dates,
                y: dailyTrends[topic],
                mode: 'lines',
                name: topic
            });
        }
        var layout = {
            title: 'Daily Complaint Trends by Topic',
            xaxis: { title: 'Date' },
            yaxis: { title: 'Number of Complaints' }
        };
        Plotly.newPlot('topic-trends-chart', data, layout);
    </script>
</body>
</html>
